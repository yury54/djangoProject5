{% load static %}
{% include "index.html" %}


<br>
<br>


    <div align="center">

      <form action="" class="form-inline" method='POST'>

    {% csrf_token %}

           <div class="form-group">


<br>

    {{ my_form }}
<table>
                <table class="table table-bordered">
<br>

<h6>Стол 1</h6>

                  <tr>

                    <td align="center" valign="center" class="time1">09:00</td>
                    <td align="center" valign="center" class="time1">09:20</td>
                    <td align="center" valign="center" class="time1">09:40</td>
                    <td align="center" valign="center" class="time1">10:00</td>
                    <td align="center" valign="center" class="time1">10:20</td>
                    <td align="center" valign="center" class="time1">10:40</td>
                    <td align="center" valign="center" class="time1">11:00</td>
                    <td align="center" valign="center" class="time1">11:20</td>
                    <td align="center" valign="center" class="time1">11:40</td>
                    <td align="center" valign="center" class="time1">12:00</td>
                    <td align="center" valign="center" class="time1">12:20</td>
                    <td align="center" valign="center" class="time1">12:40</td>
                    <td align="center" valign="center" class="time1">14:00</td>
                    <td align="center" valign="center" class="time1">14:20</td>
                    <td align="center" valign="center" class="time1">14:40</td>
                    <td align="center" valign="center" class="time1">15:00</td>
                    <td align="center" valign="center" class="time1">15:20</td>
                    <td align="center" valign="center" class="time1">15:40</td>
                    <td align="center" valign="center" class="time1">16:00</td>
                    <td align="center" valign="center" class="time1">16:20</td>
                    <td align="center" valign="center" class="time1">16:40</td>
                    <td align="center" valign="center" class="time1">17:00</td>
                    <td align="center" valign="center" class="time1">17:20</td>
                    <td align="center" valign="center" class="time1">17:40</td>

                </table>
    <table class="table table-bordered">
<h6>Стол 2</h6>

                  <tr>

                    <td align="center" valign="center" class="time2">09:00</td>
                    <td align="center" valign="center" class="time2">09:20</td>
                    <td align="center" valign="center" class="time2">09:40</td>
                    <td align="center" valign="center" class="time2">10:00</td>
                    <td align="center" valign="center" class="time2">10:20</td>
                    <td align="center" valign="center" class="time2">10:40</td>
                    <td align="center" valign="center" class="time2">11:00</td>
                    <td align="center" valign="center" class="time2">11:20</td>
                    <td align="center" valign="center" class="time2">11:40</td>
                    <td align="center" valign="center" class="time2">12:00</td>
                    <td align="center" valign="center" class="time2">12:20</td>
                    <td align="center" valign="center" class="time2">12:40</td>
                    <td align="center" valign="center" class="time2">14:00</td>
                    <td align="center" valign="center" class="time2">14:20</td>
                    <td align="center" valign="center" class="time2">14:40</td>
                    <td align="center" valign="center" class="time2">15:00</td>
                    <td align="center" valign="center" class="time2">15:20</td>
                    <td align="center" valign="center" class="time2">15:40</td>
                    <td align="center" valign="center" class="time2">16:00</td>
                    <td align="center" valign="center" class="time2">16:20</td>
                    <td align="center" valign="center" class="time2">16:40</td>
                    <td align="center" valign="center" class="time2">17:00</td>
                    <td align="center" valign="center" class="time2">17:20</td>
                    <td align="center" valign="center" class="time2">17:40</td>

                </table>
    <table class="table table-bordered">
<h6>Стол 3</h6>

                  <tr>

                    <td align="center" valign="center" class="time3">09:00</td>
                    <td align="center" valign="center" class="time3">09:20</td>
                    <td align="center" valign="center" class="time3">09:40</td>
                    <td align="center" valign="center" class="time3">10:00</td>
                    <td align="center" valign="center" class="time3">10:20</td>
                    <td align="center" valign="center" class="time3">10:40</td>
                    <td align="center" valign="center" class="time3">11:00</td>
                    <td align="center" valign="center" class="time3">11:20</td>
                    <td align="center" valign="center" class="time3">11:40</td>
                    <td align="center" valign="center" class="time3">12:00</td>
                    <td align="center" valign="center" class="time3">12:20</td>
                    <td align="center" valign="center" class="time3">12:40</td>
                    <td align="center" valign="center" class="time3">14:00</td>
                    <td align="center" valign="center" class="time3">14:20</td>
                    <td align="center" valign="center" class="time3">14:40</td>
                    <td align="center" valign="center" class="time3">15:00</td>
                    <td align="center" valign="center" class="time3">15:20</td>
                    <td align="center" valign="center" class="time3">15:40</td>
                    <td align="center" valign="center" class="time3">16:00</td>
                    <td align="center" valign="center" class="time3">16:20</td>
                    <td align="center" valign="center" class="time3">16:40</td>
                    <td align="center" valign="center" class="time3">17:00</td>
                    <td align="center" valign="center" class="time3">17:20</td>
                    <td align="center" valign="center" class="time3">17:40</td>

                </table>
    <table class="table table-bordered">
<h6>Стол 4</h6>

                  <tr>

                    <td align="center" valign="center" class="time4">09:00</td>
                    <td align="center" valign="center" class="time4">09:20</td>
                    <td align="center" valign="center" class="time4">09:40</td>
                    <td align="center" valign="center" class="time4">10:00</td>
                    <td align="center" valign="center" class="time4">10:20</td>
                    <td align="center" valign="center" class="time4">10:40</td>
                    <td align="center" valign="center" class="time4">11:00</td>
                    <td align="center" valign="center" class="time4">11:20</td>
                    <td align="center" valign="center" class="time4">11:40</td>
                    <td align="center" valign="center" class="time4">12:00</td>
                    <td align="center" valign="center" class="time4">12:20</td>
                    <td align="center" valign="center" class="time4">12:40</td>
                    <td align="center" valign="center" class="time4">14:00</td>
                    <td align="center" valign="center" class="time4">14:20</td>
                    <td align="center" valign="center" class="time4">14:40</td>
                    <td align="center" valign="center" class="time4">15:00</td>
                    <td align="center" valign="center" class="time4">15:20</td>
                    <td align="center" valign="center" class="time4">15:40</td>
                    <td align="center" valign="center" class="time4">16:00</td>
                    <td align="center" valign="center" class="time4">16:20</td>
                    <td align="center" valign="center" class="time4">16:40</td>
                    <td align="center" valign="center" class="time4">17:00</td>
                    <td align="center" valign="center" class="time4">17:20</td>
                    <td align="center" valign="center" class="time4">17:40</td>

                </table>
                {{form.time.errors}}

</table>
    {{form.time}}

            <div style="padding-left:20%;"><button id="submit" class="btn btn-success">Запись</button></div>
               </div>
</form>


    </div>
 <script type = "text/javascript">

    $(document).ready(function() {
        //дата по Ajax передается на сервер для сравнения
        // возвращается список с занятым временем для приема, для сравнения с таблицей


var checkUnavailableTime = function() {
var date_data = {
                date_from_ajax: $("input[name=r_date]").val(),
                csrfmiddlewaretoken: $("[name='csrfmiddlewaretoken']").attr('value')
            }
$.ajax({
	url: '/date_from_ajax/',
	method: 'post',
	dataType: 'json',
	data: date_data,
	success: function(response) {


                    $(".time, .time1, .time2, .time3, .time4").css("background-color", background_color);
                    $(".time, .time1, .time2, .time3, .time4").css("color", "black");

 var a =response['time_list']
        var index;




                    for (index = 0; index < (a.length); ++index) {
                        $(".time1").each(function() {

                            if ($(this).html() == response['time_list'][index][0] ){
                                if (response['time_list'][index][1]==1){
                                $(this).css("background-color", "grey");};
                            };
                        });
                        $(".time2").each(function() {

                            if ($(this).html() == response['time_list'][index][0] ){
                                if (response['time_list'][index][1]==2){
                                $(this).css("background-color", "grey");};
                            };
                        });
                        $(".time3").each(function() {

                            if ($(this).html() == response['time_list'][index][0] ){
                                if (response['time_list'][index][1]==3){
                                $(this).css("background-color", "grey");};
                            };
                        });
                        $(".time4").each(function() {

                            if ($(this).html() == response['time_list'][index][0] ){
                                if (response['time_list'][index][1]==4){
                                $(this).css("background-color", "grey");};
                            };
                        });

                    }
                }
});

 };
//  таблица времени приема
        var background_color = $(".time,.time1, .time2, .time3,.time4 ").css("background-color")


        $(".time,.time1,.time2,.time3,.time4").click(function(event) {

            event.preventDefault();

            $(".time,.time1,.time2,.time3,.time4").each(function() {
                $(this).css("color", "black");
            });
            if ($(this).css("background-color") !== "rgb(128, 128, 128)") {
                $(this).css("color", "#FF00FF");
                let stol = event.target.className.replace(/\D+/, '');


                let time = $(this).html();
               $("#id_stol").attr('value', stol);
                $("#id_time").attr('value', time);
            } else {
                $("#id_time").attr('value', '')
            }
        });
        $(".time,.time1,.time2,.time3,.time4").mouseover(function(event) {
            if ($(this).css("background-color") !== "rgb(128, 128, 128)") {
                $(this).css("background-color", "#CEF6D8");
            };
        }).mouseout(function(event) {
            if ($(this).css("background-color") !== "rgb(128, 128, 128)") {
                $(this).css("background-color", background_color);
            };
        });
// при выборе даты -идет запрос на сервер и возвращаются часы приема, кот уже заняты
        $("input[name=r_date]").change(function() {
            checkUnavailableTime();
        });
        // когда приходит сообщение что есть ошибки в заполении формы -
        //также идет запрос на сервер и возвращаются часы приема, кот уже заняты
        if ($(".errorlist").html() !== "" && $("input[name=r_date]").val() !== "") {
            checkUnavailableTime();
        }
 });
    </script>
<script>
    function setStol(stol) {
        var num = stol.replace(/\D+/, '');
        return num;
    }
  </script>


</body>
</html>